# vim 程序编辑器

[官网](http://www.vim.org)

##１．vi与vim

### vi的使用

vi基本上有三种模式，一般模式，编辑模式与命令行模式

1. 一般模式：

   刚进入文件时的模式（默认模式），可以增减，复制粘贴数据

2. 编辑模式：

   按下'i,I,o,O,a,A,r,R'时会进去，按Esc键回到一般模式

3. 命令行模式：

   在一般模式，输入":, /, ?"三个键后都会进入这种模式，这种模式提供查找，读取，保存，大量替换字符，离开vi，显示行号等功能．按Esc键回到一般模式

### 按键说明

**第一部份：一般模式可用的按钮说明，光标移动、复制粘贴、查找替换等**

|                 移动光标的方法                  |                                          |
| :--------------------------------------: | :--------------------------------------: |
|               h 或 向左箭头键(←)               |                光标向左移动一个字符                |
|               j 或 向下箭头键(↓)               |                光标向下移动一个字符                |
|               k 或 向上箭头键(↑)               |                光标向上移动一个字符                |
|               l 或 向右箭头键(→)               |                光标向右移动一个字符                |
| 如果你将右手放在键盘上的话，你会发现 hjkl 是排列在一起的，因此可以使用这四个按钮来移动光标。 如果想要进行多次移动的话，例如向下移动 30 行，可以使用 "30j" 或 "30↓" 的组合按键， 亦即加上想要进行的次数(数字)后，按下动作即可！ |                                          |
|               [Ctrl] + [f]               |    屏幕『向下』移动一页，相当于 [Page Down]按键 (常用)     |
|               [Ctrl] + [b]               |     屏幕『向上』移动一页，相当于 [Page Up] 按键 (常用)     |
|               [Ctrl] + [d]               |                屏幕『向下』移动半页                |
|               [Ctrl] + [u]               |                屏幕『向上』移动半页                |
|                    +                     |              光标移动到非空格符的下一列               |
|                    -                     |              光标移动到非空格符的上一列               |
|                 n<space>                 | 那个 n 表示『数字』，例如 20 。按下数字后再按空格键，光标会向右移动这一行的 n 个字符。例如 20<space> 则光标会向后面移动 20 个字符距离。 |
|               0 或功能键[Home]               |       这是数字『 0 』：移动到这一行的最前面字符处 (常用)       |
|               $ 或功能键[End]                |            移动到这一行的最后面字符处(常用)             |
|                    H                     |          光标移动到这个屏幕的最上方那一行的第一个字符          |
|                    M                     |          光标移动到这个屏幕的中央那一行的第一个字符           |
|                    L                     |          光标移动到这个屏幕的最下方那一行的第一个字符          |
|                    G                     |             移动到这个档案的最后一行(常用)             |
|                    nG                    | n 为数字。移动到这个档案的第 n 行。例如 20G 则会移动到这个档案的第 20 行(可配合 :set nu) |
|                    gg                    |        移动到这个档案的第一行，相当于 1G 啊！ (常用)        |
|                 n<Enter>                 |           n 为数字。光标向下移动 n 行(常用)           |
|                  搜寻与取代                   |                                          |
|                  /word                   | 向光标之下寻找一个名称为 word 的字符串。例如要在档案内搜寻 vbird 这个字符串，就输入 /vbird 即可！ (常用) |
|                  ?word                   |        向光标之上寻找一个字符串名称为 word 的字符串。        |
|                    n                     | 这个 n 是英文按键。代表『重复前一个搜寻的动作』。举例来说， 如果刚刚我们执行 /vbird 去向下搜寻 vbird 这个字符串，则按下 n 后，会向下继续搜寻下一个名称为 vbird 的字符串。如果是执行 ?vbird 的话，那么按下 n 则会向上继续搜寻名称为 vbird 的字符串！ |
|                    N                     | 这个 N 是英文按键。与 n 刚好相反，为『反向』进行前一个搜寻动作。 例如 /vbird 后，按下 N 则表示『向上』搜寻 vbird 。 |
| 使用 /word 配合 n 及 N 是非常有帮助的！可以让你重复的找到一些你搜寻的关键词！ |                                          |
|          :n1,n2s/word1/word2/g           | n1 与 n2 为数字。在第 n1 与 n2 行之间寻找 word1 这个字符串，并将该字符串取代为 word2 ！举例来说，在 100 到 200 行之间搜寻 vbird 并取代为 VBIRD 则：『:100,200s/vbird/VBIRD/g』。(常用) |
|           :1,$s/word1/word2/g            | 从第一行到最后一行寻找 word1 字符串，并将该字符串取代为 word2 ！(常用) |
|           :1,$s/word1/word2/gc           | 从第一行到最后一行寻找 word1 字符串，并将该字符串取代为 word2 ！且在取代前显示提示字符给用户确认 (confirm) 是否需要取代！(常用) |
|                 删除、复制与贴上                 |                                          |
|                   x, X                   | 在一行字当中，x 为向后删除一个字符 (相当于 [del] 按键)， X 为向前删除一个字符(相当于 [backspace] 亦即是退格键) (常用) |
|                    nx                    | n 为数字，连续向后删除 n 个字符。举例来说，我要连续删除 10 个字符， 『10x』。 |
|                    dd                    |             删除游标所在的那一整列(常用)              |
|                   ndd                    | n 为数字。删除光标所在的向下 n 列，例如 20dd 则是删除 20 列 (常用) |
|                   d1G                    |             删除光标所在到第一行的所有数据              |
|                    dG                    |             删除光标所在到最后一行的所有数据             |
|                    d$                    |            删除游标所在处，到该行的最后一个字符            |
|                    d0                    |      那个是数字的 0 ，删除游标所在处，到该行的最前面一个字符       |
|                    yy                    |              复制游标所在的那一行(常用)              |
|                   nyy                    | n 为数字。复制光标所在的向下 n 列，例如 20yy 则是复制 20 列(常用) |
|                   y1G                    |             复制游标所在列到第一列的所有数据             |
|                    yG                    |            复制游标所在列到最后一列的所有数据             |
|                    y0                    |          复制光标所在的那个字符到该行行首的所有数据           |
|                    y$                    |          复制光标所在的那个字符到该行行尾的所有数据           |
|                   p, P                   | p 为将已复制的数据在光标下一行贴上，P 则为贴在游标上一行！ 举例来说，我目前光标在第 20 行，且已经复制了 10 行数据。则按下 p 后， 那 10 行数据会贴在原本的 20 行之后，亦即由 21 行开始贴。但如果是按下 P 呢？ 那么原本的第 20 行会被推到变成 30 行。 (常用) |
|                    J                     |           将光标所在列与下一列的数据结合成同一列            |
|                    c                     |      重复删除多个数据，例如向下删除 10 行，[ 10cj ]       |
|                    u                     |               复原前一个动作。(常用)               |
|                 [Ctrl]+r                 |               重做上一个动作。(常用)               |
| 这个 u 与 [Ctrl]+r 是很常用的指令！一个是复原，另一个则是重做一次～ 利用这两个功能按键，你的编辑，嘿嘿！很快乐的啦！ |                                          |
|                    .                     | 不要怀疑！这就是小数点！意思是重复前一个动作的意思。 如果你想要重复删除、重复贴上等等动作，按下小数点『.』就好了！ (常用) |

**第二部份：一般模式切换到编辑模式的可用的按钮说明**

|               进入插入或取代的编辑模式               |                                          |
| :--------------------------------------: | :--------------------------------------: |
|                   i, I                   | 进入插入模式(Insert mode)：i 为『从目前光标所在处插入』， I 为『在目前所在行的第一个非空格符处开始插入』。 (常用) |
|                   a, A                   | 进入插入模式(Insert mode)：a 为『从目前光标所在的下一个字符处开始插入』， A 为『从光标所在行的最后一个字符处开始插入』。(常用) |
|                   o, O                   | 进入插入模式(Insert mode)：这是英文字母 o 的大小写。o 为『在目前光标所在的下一行处插入新的一行』； O 为在目前光标所在处的上一行插入新的一行！(常用) |
|                   r, R                   | 进入取代模式(Replace mode)：r 只会取代光标所在的那一个字符一次；R会一直取代光标所在的文字，直到按下 ESC 为止；(常用) |
| 上面这些按键中，在 vi 画面的左下角处会出现『--INSERT--』或『--REPLACE--』的字样。 由名称就知道该动作了吧！！特别注意的是，我们上面也提过了，你想要在档案里面输入字符时， 一定要在左下角处看到 INSERT 或 REPLACE 才能输入喔！ |                                          |
|                  [Esc]                   |            退出编辑模式，回到一般模式中(常用)            |

**第三部份：一般模式切换到指令列模式的可用的按钮说明**

|             指令列的储存、离开等指令             |                                          |
| :----------------------------------: | :--------------------------------------: |
|                  :w                  |            将编辑的数据写入硬盘档案中(常用)             |
|                 :w!                  | 若文件属性为『只读』时，强制写入该档案。不过，到底能不能写入， 还是跟你对该档案的档案权限有关啊！ |
|                  :q                  |                离开 vi (常用)                |
|                 :q!                  |      若曾修改过档案，又不想储存，使用 ! 为强制离开不储存档案。      |
| 注意一下啊，那个惊叹号 (!) 在 vi 当中，常常具有『强制』的意思～ |                                          |
|                 :wq                  |       储存后离开，若为 :wq! 则为强制储存后离开 (常用)       |
|                  ZZ                  | 这是大写的 Z 喔！若档案没有更动，则不储存离开，若档案已经被更动过，则储存后离开！ |
|            :w [filename]             |          将编辑的数据储存成另一个档案（类似另存新档）          |
|            :r [filename]             | 在编辑的数据中，读入另一个档案的数据。亦即将 『filename』 这个档案内容加到游标所在行后面 |
|         :n1,n2 w [filename]          |     将 n1 到 n2 的内容储存成 filename 这个档案。      |
|              :! command              | 暂时离开 vi 到指令列模式下执行 command 的显示结果！例如『:! ls /home』即可在 vi 当中察看 /home 底下以 ls 输出的档案信息！ |
|              vim 环境的变更               |                                          |
|               :set nu                |        显示行号，设定之后，会在每一行的前缀显示该行的行号         |
|              :set nonu               |            与 set nu 相反，为取消行号！            |

### 块选择

块选择的命令用于一般模式

如下表：

|  块选择按键   |         含义         |
| :------: | :----------------: |
|    v     | 字符选择，会将光标经过的地方反白选择 |
|  V(大写)   |  行选择，会将光标经过的反白行选择  |
| [ctrl]+v |  快选择，可用长方形的方式选择数据  |
|    y     |     将反白的地方复制起来     |
|    d     |      将反白的地方删除      |

### 多文件编辑

当想在多文件之间进行复制时，可以打开多个文件，如下：

```
# 同时打开　1.txt 2.txt
# vim 1.txt 2.txt
```

之后的命令：

|   命令   |      含义      |
| :----: | :----------: |
|   :n   |   编辑下一个文件    |
|   :N   |   编辑上一个文件    |
| :files | 查看目前vim打开的文件 |

复制粘贴后直接用平常命令退出

这个功能也可以用多窗口界面来实现

### 多窗口功能

适用的情况：

1. 当文件较大，想对文件前后数据进行比较时
2. 当需要比对两个文件时

使用方法，在命令行模式输入如下指令：

```
:sp{filename}
# 当没有filename时，会新增一个窗口来再次显示此文件
# 当加入另一个文件名时，会在新建的页面显示第二个文件的内容
```

命令如下：

|                    命令                    |              含义              |
| :--------------------------------------: | :--------------------------: |
|              :sp [filename]              |              见上              |
| ［ctrl]+w+j      或       [ctrl]+w+(向下箭头键) |         将光标移动到下一个窗口          |
| ［ctrl]+w+k      或       [ctrl]+w+(向上箭头键) |         将光标移动到上一个窗口          |
|                [ctrl]+w+q                | 结束下方的窗口（不需要，直接切到要关闭的窗口q就可以了） |

### vim环境设置与记录：~/.vimrc,  ~/.viminfo

~/.viminfo: 会记录下上次的操作，如光标位置，反白的区域等

vim的环境配置参数有很多，可以在命令行，模式下输入```:set all```命令查看

创常见的参数如下：

| １:set nu２:set nonu                 | 就是设置与取消行号                                |
| ---------------------------------- | ---------------------------------------- |
| １:set hlsearch２:set nohlsearch     | hlsearch就是high light search（高亮度查找）。这个就是设置是否将查找的字符串反白的设置值。默认是hlsearch |
| １:set autoindent２:set noautoindent | 表示是否自动缩排，autoindent就是自动缩排                |
| :set backup                        | 表示是否自动保存备份文件，一般是nobackup的，如果设置backup的话，那么当你改动任何一个文件是，则原文件会在源文件同一目录下被另存为一个文件名为filename~的文件。 |
| :set ruler                         | 设置显示右下角的状态栏说明                            |
| :set showmode                      | 设置显示左下角的状态栏说明                            |
| :set backspace=(012)               | 在我们按下i进入编辑模式后，可以利用刻个件（backspace）来删除任意字符的。但是，某些distribution则不是如此。此时，我们就可以通过设置backspace来设置。当backspace为2时，就是可以删除任意字符；为0或1时，仅可删除刚才输入的字符，而无法删除原本就已经存在的文字了 |
| :set all                           | 显示目前所有的环境参数设置值                           |
| :set                               | 显示与系统默认不同的设置参数，一般来说就是你有自行变动过的设置参数        |
| １:syntax on２:syntax off            | 表示是否依据程序相关语法显示不同颜色。                      |
| １:set bg=dark２:set bg=light        | 可用以显示不同的颜色色调默认是light。如果你经常发现批注的字体深蓝色实在很不容易看，那么这里可以设置为dark，会有不同的样式 |

我们可以通过配置文件来直接规定我们习惯的vim操作环境。整体vim的设置值一般是在/etc/vimrc这个文件中，不过，不建议你修改它。你可以修改~/.vimrc这个文件（默认不存在，请你自行手动创建），将你希望的设置值写入。

```
$ vim ~/.vimrc
#　输入以下内容
"这个文件的双引号（＂）是注释
set hlsearch "高亮度反白　　　　　　　　　　　　　　　　<==见面的冒号可加可不加
set backspace=2 "可随时用退格键删除
set autoindent  "自动缩进
set nu  "显示行号
syntax on     "进行语法检验，颜色显示
# 保存就好
```

## ２．其他vim使用事项

### 中文编码的问题

．．．

### DOS与Linux的断行字符

```由于Dos的断行符是^M$,linux的断行符为$(LF)```，所有在不同系统下传输文件时要注意转换

使用命令UNIX2dos和dos2UNIX

[安装包下载地址](https://sourceforge.net/projects/dos2unix/)

```
# 安装
$ wget -o dos2unix-7.4.0.tar.gz https://sourceforge.net/projects/dos2unix/files/latest/download <<?????
$ tar -zxv -f dos2unix-7.4.0.tar.gz
$ cd dos2unix-7.4.0
$ make
# make install
```



```
# linux的文件转换为dos换行
$ unix2dos -k 1.txt
# dos文件转换为linux断行
$ dos2unix -k -n 2.txt.dos　2.txt.linux

# 参数
# -k 保留文件原本的mtime
# -n 保留源文件，新生成一个文件,如：UNIX2dos -n old new
```

```
用vim、tr、awk等都能转
使用vim：
# vimdosfile.txt
DOS转UNIX   :setfileformat=unix
UNIX转DOS   :setfileformat=dos
使用awk
DOS转UNIX：awk ‘{sub(“\r$”,“”, $0);print $0}’ dosfile.txt > unixfile.txt
UNIX转DOS：awk ‘{sub(“$”,“\r”, $0);print $0}’ dosfile.txt > unixfile.txt
使用sed：
DOS转UNIX：$ sed ‘s/.$//’dosfile.txt > unixfile.txt
UNIX转DOS：$ sed ’s/$/\r/’unixfile.txt > dosfile.txt
使用tr：
使用tr命令拷贝标准输入到标准输出，替换或者删除掉选择的字符，只能把DOS转换为UNIX文件，命令如下：
# tr -d ‘\r’< dosfile.txt > unixfile.txt
```